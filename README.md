# encryption
这个项目全部是关于加密算法相关的
# 以下是摘抄知乎
作者：林淼
链接：https://www.zhihu.com/question/45203206/answer/231421178
来源：知乎
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

     前言: 服务器启用ssl功能需要生成一对RSA 私钥/公钥对(Apub/Apriv),  然后生成包含自己域名和公钥的证书，把证书提交给CA请求签名。以后每次收到连接请求都会发送证书给客户。 该用于身份认证的RSA 公钥/私钥对长期使用。
     如果采用Perfect Forward Secrecy， 针对每个session客户端和服务器都分别生成临时的(Ephemeral)随机DH/ECDH私钥EPk (DH/ECDH也是一种非对称算法),  根据此随机的私钥EPk和对方传过来的DH/ECDH公钥计算出共享的preMaster key, 再用哈系函数处理preMaster key计算出AES的加密/解密密钥。 由于DH/ECDH私钥不经过网络传输，每次会话结束就被删除，和RAS 私钥Apriv无关，因此即使长期使用的Apriv被非法获取，以往监听到的加密数据也无法被解密(除非有能力拿到每个session的DH私钥，这是不可能的)。  可见密码学安全的随机数生成算法有多重要。
     当然除了长期使用的用于身份认证的公钥私钥对Apub/Apriv, 服务器也可以为每次(多次)会话都生成一对新的RSA 公钥/私钥 Tpub/Tpriv用于AES密钥交换。 服务器用证书私钥Apriv签名Tpub的hash值，并传输Tpub和Tpub的hash签名给客户端。 客户端用收到的Tpub加密随机生成的AES密钥K并传给服务器，服务器用Tpriv解密K，双方就可以用K加密解密实际的消息了。 双RSA虽然也能实现PFS，但是效率太差，没有公司会采用， 基本都是RSA+ECDHE。

# DH密钥交换和ECDH原理（摘抄CSDN）

下面我们以Alice和Bob为例叙述Diffie-Hellman密钥交换的原理。

1,Diffie-Hellman交换过程中涉及到的所有参与者定义一个组，在这个组中定义一个大质数p，底数g。

2,Diffie-Hellman密钥交换是一个两部分的过程，Alice和Bob都需要一个私有的数字a，b。

下面是DH交换的过程图：

本图片来自wiki

下面我们进行一个实例

1.爱丽丝与鲍伯协定使用p=23以及g=5.

2.爱丽丝选择一个秘密整数a=6, 计算A = g^a mod p并发送给鲍伯。
   A = 5^6 mod 23 = 8.

3.鲍伯选择一个秘密整数b=15, 计算B = g^b mod p并发送给爱丽丝。
   B = 5^15 mod 23 = 19.

4.爱丽丝计算s = B a mod p
  19^6 mod 23 = 2.

5.鲍伯计算s = A b mod p
   8^15 mod 23 = 2.

 

ECDH密钥交换：

ECDH:

       ECC算法和DH结合使用，用于密钥磋商，这个密钥交换算法称为ECDH。交换双方可以在不共享任何秘密的情况下协商出一个密钥。ECC是建立在基于椭圆曲线的离散对数问题上的密码体制，给定椭圆曲线上的一个点P，一个整数k，求解Q=kP很容易；给定一个点P、Q，知道Q=kP，求整数k确是一个难题。ECDH即建立在此数学难题之上。密钥磋商过程：

假设密钥交换双方为Alice、Bob，其有共享曲线参数（椭圆曲线E、阶N、基点G）。

1) Alice生成随机整数a，计算A=a*G。 #生成Alice公钥

2) Bob生成随机整数b，计算B=b*G。 #生产Bob公钥

3) Alice将A传递给Bob。A的传递可以公开，即攻击者可以获取A。

    由于椭圆曲线的离散对数问题是难题，所以攻击者不可以通过A、G计算出a。

4) Bob将B传递给Alice。同理，B的传递可以公开。

5) Bob收到Alice传递的A，计算Q =b*A  #Bob通过自己的私钥和Alice的公钥得到对称密钥Q

6) Alice收到Bob传递的B，计算Q`=a*B  #Alice通过自己的私钥和Bob的公钥得到对称密钥Q'

Alice、Bob双方即得Q=b*A=b*(a*G)=(b*a)*G=(a*b)*G=a*(b*G)=a*B=Q' (交换律和结合律)，即双方得到一致的密钥Q。 


# 密匙交换算法综述
  为了网络通讯安全，一般都会采用加密手段，考虑性能使用对称加密，对称加密秘钥定期更换，比如设置加密使用次数，加密使用时间等。这样就需要一个稳妥的秘钥交换方式，可以采用的方式：
  1.RSA算法：可以做加密，秘钥交换，身份认证等，可以防中间人攻击,但是不提供PFS（Perfect Forward Secrecy,前向安全,通俗说法即，秘钥丢失的话，以前的密文可以被解密导致信息泄露）特性.
  2.DH算法:秘钥交换，提供PFS，但是不能防止中间人攻击。
  3.ECDHE算法:DH算法的扩展，提交安全性和性能
# 算法选择
  RSA+ECDHE:保证FPS,并防止中间人攻击，安全和性能满足企业商用
# 业务架构
   client                              
     |                                    
     |1.ECDHE 产生可公开秘钥q               
     |2.RSA公钥加密秘钥q得到密文q1，发送至服务端
     |3.服务端使用私钥解密q1得等q
     |4.根据q生成对应秘钥r,并返回r，同时生成签名s给客户端
     |5.客户端公钥验证签名s,并通过q+r得到真正的秘钥k
     |6.服务端通过q+r得到真正的秘钥k
     |7.使用秘钥k加密通讯，设置定期更换策略。

  